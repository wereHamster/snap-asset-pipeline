<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Snap.Assets</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Snap-Assets.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Snap-Assets.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">snap-assets-0.1.0.0</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">Snap.Assets</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Configuration
</a></li><li><a href="#g:2">The Asset type
</a></li><li><a href="#g:3">Builders
</a></li><li><a href="#g:4">Snap handlers
</a></li><li><a href="#g:5">Template helpers
</a></li><li><a href="#g:6">Tooling support
</a></li></ul></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span>  <a href="#t:Config">Config</a>  = <a href="#v:Config">Config</a> {<ul class="subs"><li><a href="#v:sourceDirectory">sourceDirectory</a> :: <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-String.html#t:String">String</a></li><li><a href="#v:assetDefinitions">assetDefinitions</a> :: [<a href="Snap-Assets.html#t:Asset">Asset</a>]</li><li><a href="#v:assetHost">assetHost</a> :: Snap <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-String.html#t:String">String</a></li><li><a href="#v:pathPrefix">pathPrefix</a> :: <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-String.html#t:String">String</a></li><li><a href="#v:manifest">manifest</a> :: <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Snap-Assets.html#t:Manifest">Manifest</a></li></ul>}</li><li class="src short"><span class="keyword">type</span> <a href="#t:Manifest">Manifest</a> = <a href="/usr/share/doc/ghc/html/libraries/containers-0.5.0.0/Data-Map-Lazy.html#t:Map">Map</a> <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-String.html#t:String">String</a> <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-String.html#t:String">String</a></li><li class="src short"><a href="#v:defaultConfig">defaultConfig</a> :: <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/System-IO.html#t:IO">IO</a> <a href="Snap-Assets.html#t:Config">Config</a></li><li class="src short"><span class="keyword">data</span>  <a href="#t:Asset">Asset</a>  = <a href="#v:Asset">Asset</a> {<ul class="subs"><li><a href="#v:assetName">assetName</a> :: <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-String.html#t:String">String</a></li><li><a href="#v:assetBuilder">assetBuilder</a> :: <a href="Snap-Assets.html#t:Builder">Builder</a></li></ul>}</li><li class="src short"><span class="keyword">type</span> <a href="#t:Builder">Builder</a> = <a href="Snap-Assets.html#t:Config">Config</a> -&gt; <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Maybe.html#t:Maybe">Maybe</a> <a href="/usr/share/doc/ghc/html/libraries/time-1.4.0.1/Data-Time-Clock.html#t:UTCTime">UTCTime</a> -&gt; <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/System-IO.html#t:IO">IO</a> <a href="Snap-Assets.html#t:BuilderResult">BuilderResult</a></li><li class="src short"><span class="keyword">data</span>  <a href="#t:BuilderResult">BuilderResult</a> <ul class="subs"><li>= <a href="#v:NotModified">NotModified</a>  </li><li>| <a href="#v:Contents">Contents</a> <a href="/usr/share/doc/ghc/html/libraries/bytestring-0.10.0.2/Data-ByteString-Lazy.html#t:ByteString">ByteString</a>  </li></ul></li><li class="src short"><a href="#v:concatBuilder">concatBuilder</a> :: [<a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/System-IO.html#t:FilePath">FilePath</a>] -&gt; <a href="Snap-Assets.html#t:Builder">Builder</a></li><li class="src short"><a href="#v:snapAssetHandler">snapAssetHandler</a> :: <a href="Snap-Assets.html#t:Config">Config</a> -&gt; Snap ()</li><li class="src short"><a href="#v:assetPath">assetPath</a> :: <a href="Snap-Assets.html#t:Config">Config</a> -&gt; <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-String.html#t:String">String</a> -&gt; <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-String.html#t:String">String</a></li><li class="src short"><a href="#v:assetUrl">assetUrl</a> :: <a href="Snap-Assets.html#t:Config">Config</a> -&gt; <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-String.html#t:String">String</a> -&gt; Snap <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-String.html#t:String">String</a></li><li class="src short"><a href="#v:compileAssets">compileAssets</a> :: <a href="Snap-Assets.html#t:Config">Config</a> -&gt; <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-String.html#t:String">String</a> -&gt; <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/System-IO.html#t:IO">IO</a> <a href="Snap-Assets.html#t:Manifest">Manifest</a></li></ul></div><div id="interface"><h1 id="g:1">Configuration
</h1><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:Config" class="def">Config</a>  <a href="src/Snap-Assets.html#Config" class="link">Source</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Config" class="def">Config</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:sourceDirectory" class="def">sourceDirectory</a> :: <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-String.html#t:String">String</a></dt><dd class="doc"><p>The root path where the assets are kept. Paths you use in the
   builders are relative to this root. Most projects will have an
   'assets/' directory where all the javascript, css, images are kept.
   The asset pipeline reads from that directory and serves those files
   to clients.
</p></dd><dt class="src"><a name="v:assetDefinitions" class="def">assetDefinitions</a> :: [<a href="Snap-Assets.html#t:Asset">Asset</a>]</dt><dd class="doc"><p>The list of all assets that are known and served to clients. It is
   used by the snap handler and compiler to generate the files. If you
   have the snap handler disabled (eg. when running in production
   mode), it's safe to leave this list empty.
</p></dd><dt class="src"><a name="v:assetHost" class="def">assetHost</a> :: Snap <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-String.html#t:String">String</a></dt><dd class="doc"><p>The asset host used to serve the assets. Used by <code><a href="Snap-Assets.html#v:assetUrl">assetUrl</a></code> and
   <code><a href="Snap-Assets.html#v:assetPath">assetPath</a></code> to generate the urls. Also see <code><a href="Snap-Assets.html#v:pathPrefix">pathPrefix</a></code>. You
   generally have two choices:
</p><ul><li> Extract the host from the request (default).
</li><li> Use a single fixed host (eg. if you want to use a CDN).
</li></ul><p>The function should return the full authority, including the
   leading <code>//</code>. Scheme and port are optional.
</p><pre> &quot;//localhost&quot;         -- Minimal definition.
 &quot;//localhost:8000&quot;    -- Non-standard port.
 &quot;http://localhost&quot;    -- Explicit scheme.
</pre></dd><dt class="src"><a name="v:pathPrefix" class="def">pathPrefix</a> :: <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-String.html#t:String">String</a></dt><dd class="doc"><p>This prefix is added to paths generated by <code><a href="Snap-Assets.html#v:assetPath">assetPath</a></code> and
   <code><a href="Snap-Assets.html#v:assetUrl">assetUrl</a></code>. Default is <code>assets</code>. If you have a dedicated asset
   host, you can leave this an empty string. The two most often used
   combinations of <code><a href="Snap-Assets.html#v:assetHost">assetHost</a></code> and <code><a href="Snap-Assets.html#v:pathPrefix">pathPrefix</a></code> are:
</p><ul><li> Using a dedicated asset host (or a CDN).
</li></ul><pre> config = { assetHost = return &quot;assets.domain.tld&quot;, pathPrefix = &quot;&quot; }

   assetUrl   -&gt;  &quot;http://assets.domain.tld/file.js&quot;
   assetPath  -&gt;  &quot;http://assets.domain.tld/file.js&quot;
</pre><ul><li> Serving assets from a subdirectory of the same host as your app.
</li></ul><pre> config = { assetHost = fromRequest, pathPrefix = &quot;/assets&quot; }

   assetUrl   -&gt;  &quot;http://domain.tld/assets/file.js&quot;
   assetPath  -&gt;  &quot;/assets/file.js&quot;
</pre></dd><dt class="src"><a name="v:manifest" class="def">manifest</a> :: <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Snap-Assets.html#t:Manifest">Manifest</a></dt><dd class="doc"><p>If set, asset urls and paths will be fingerprinted using the hashes
   stored in the manifest. This is something you'd want to enable when
   your application is running in production mode. You can store the
   manifest on disk (as YAML, JSON, plain text etc) and load when your
   application is starting, or compile it into your app.
</p></dd></dl><div class="clear"></div></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:Manifest" class="def">Manifest</a> = <a href="/usr/share/doc/ghc/html/libraries/containers-0.5.0.0/Data-Map-Lazy.html#t:Map">Map</a> <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-String.html#t:String">String</a> <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-String.html#t:String">String</a><a href="src/Snap-Assets.html#Manifest" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:defaultConfig" class="def">defaultConfig</a> :: <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/System-IO.html#t:IO">IO</a> <a href="Snap-Assets.html#t:Config">Config</a><a href="src/Snap-Assets.html#defaultConfig" class="link">Source</a></p></div><h1 id="g:2">The Asset type
</h1><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:Asset" class="def">Asset</a>  <a href="src/Snap-Assets.html#Asset" class="link">Source</a></p><div class="doc"><p>Describes an asset that is served to the clients. Each asset has a name
   (that is the string that is used in the incoming requests' URL) and
   a builder which specifies how to build the asset. The contents are
   basically a ByteString which is sent in the response back to the client.
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Asset" class="def">Asset</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:assetName" class="def">assetName</a> :: <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-String.html#t:String">String</a></dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:assetBuilder" class="def">assetBuilder</a> :: <a href="Snap-Assets.html#t:Builder">Builder</a></dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div></div><h1 id="g:3">Builders
</h1><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:Builder" class="def">Builder</a><a href="src/Snap-Assets.html#Builder" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">&nbsp;= <a href="Snap-Assets.html#t:Config">Config</a></td><td class="doc"><p>Config so the builder knows where the root is
</p></td></tr><tr><td class="src">-&gt; <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Maybe.html#t:Maybe">Maybe</a> <a href="/usr/share/doc/ghc/html/libraries/time-1.4.0.1/Data-Time-Clock.html#t:UTCTime">UTCTime</a></td><td class="doc"><p>The contents of the If-Modified-Since header,
   so the builder can return NotModified if
   appropriate.
</p></td></tr><tr><td class="src">-&gt; <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/System-IO.html#t:IO">IO</a> <a href="Snap-Assets.html#t:BuilderResult">BuilderResult</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Builds (compiles, generates, ..) the contents of an asset. Runs in the IO
   monad so you can do file IO etc. The builder should also have access to
   the Config so it knows where the root is.
</p></div></div><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:BuilderResult" class="def">BuilderResult</a>  <a href="src/Snap-Assets.html#BuilderResult" class="link">Source</a></p><div class="doc"><p>The result of a build.
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:NotModified" class="def">NotModified</a></td><td class="doc"><p>The contents have not been modified since the last request. This is
   especially important in development mode where you don't want to be
   needlessly rebuilding the assets.
</p></td></tr><tr><td class="src"><a name="v:Contents" class="def">Contents</a> <a href="/usr/share/doc/ghc/html/libraries/bytestring-0.10.0.2/Data-ByteString-Lazy.html#t:ByteString">ByteString</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><p id="control.i:BuilderResult" class="caption collapser" onclick="toggleSection('i:BuilderResult')">Instances</p><div id="section.i:BuilderResult" class="show"><table><tr><td class="src"><a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Text-Show.html#t:Show">Show</a> <a href="Snap-Assets.html#t:BuilderResult">BuilderResult</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:concatBuilder" class="def">concatBuilder</a> :: [<a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/System-IO.html#t:FilePath">FilePath</a>] -&gt; <a href="Snap-Assets.html#t:Builder">Builder</a><a href="src/Snap-Assets.html#concatBuilder" class="link">Source</a></p><div class="doc"><p>Concatenate all files into a single blob.
</p></div></div><h1 id="g:4">Snap handlers
</h1><div class="top"><p class="src"><a name="v:snapAssetHandler" class="def">snapAssetHandler</a> :: <a href="Snap-Assets.html#t:Config">Config</a> -&gt; Snap ()<a href="src/Snap-Assets.html#snapAssetHandler" class="link">Source</a></p></div><h1 id="g:5">Template helpers
</h1><div class="top"><p class="src"><a name="v:assetPath" class="def">assetPath</a> :: <a href="Snap-Assets.html#t:Config">Config</a> -&gt; <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-String.html#t:String">String</a> -&gt; <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-String.html#t:String">String</a><a href="src/Snap-Assets.html#assetPath" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:assetUrl" class="def">assetUrl</a> :: <a href="Snap-Assets.html#t:Config">Config</a> -&gt; <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-String.html#t:String">String</a> -&gt; Snap <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-String.html#t:String">String</a><a href="src/Snap-Assets.html#assetUrl" class="link">Source</a></p><div class="doc"><p>Generate the asset url for the asset with the given name. If we have
   a manifest we fingerprint the name with the hash from the manifest.
</p></div></div><h1 id="g:6">Tooling support
</h1><div class="top"><p class="src"><a name="v:compileAssets" class="def">compileAssets</a> :: <a href="Snap-Assets.html#t:Config">Config</a> -&gt; <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-String.html#t:String">String</a> -&gt; <a href="/usr/share/doc/ghc/html/libraries/base-4.6.0.1/System-IO.html#t:IO">IO</a> <a href="Snap-Assets.html#t:Manifest">Manifest</a><a href="src/Snap-Assets.html#compileAssets" class="link">Source</a></p><div class="doc"><p>For each asset, run the builder to generate the contents, then take the
   SHA1 of that and add to the manifest. Write the generated files into
   the output directory, using the correct (fingerprinted) name.
   The idea is then to upload the contents of the output directory to your
   CDN, so it can be served by fast/dedicated servers.
</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.13.2</p></div></body></html>